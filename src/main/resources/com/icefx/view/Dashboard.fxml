<?xml version="1.0" encoding="UTF-8"?>

<?import javafx.geometry.Insets?>
<?import javafx.scene.control.*?>
<?import javafx.scene.image.ImageView?>
<?import javafx.scene.layout.*?>
<?import javafx.scene.shape.Circle?>

<BorderPane xmlns="http://javafx.com/javafx/23" xmlns:fx="http://javafx.com/fxml/1"
            fx:controller="com.icefx.controller.DashboardController"
            styleClass="root-container"
            stylesheets="@../styles/enterprise-theme.css">

    <top>
        <HBox styleClass="header-bar" alignment="CENTER_LEFT" spacing="20">
            <padding>
                <Insets topRightBottomLeft="16"/>
            </padding>
            
            <Label text="IceFX Attendance" styleClass="header-title"/>
            
            <Region HBox.hgrow="ALWAYS"/>
            
            <VBox alignment="CENTER_RIGHT" spacing="2">
                <Label fx:id="userNameLabel" text="Student Name" styleClass="header-user-name"/>
                <Label fx:id="userRoleLabel" text="Role" styleClass="header-user-role"/>
            </VBox>
            
            <Button text="Logout" styleClass="btn, btn-outlined, btn-error" onAction="#handleLogout">
                <graphic>
                    <Label text="ðŸšª" style="-fx-font-size: 16px;"/>
                </graphic>
            </Button>
        </HBox>
    </top>

    <center>
        <HBox spacing="20" styleClass="content-area">
            <padding>
                <Insets topRightBottomLeft="20"/>
            </padding>

            <VBox spacing="16" HBox.hgrow="ALWAYS" styleClass="section-container">
                <Label text="Live Camera Feed" styleClass="section-title"/>
                
                <StackPane fx:id="cameraContainer" styleClass="camera-panel" VBox.vgrow="ALWAYS">
                    <ImageView fx:id="currentFrame" fitWidth="640" fitHeight="480" preserveRatio="true"/>
                    
                    <VBox fx:id="loadingOverlay" alignment="CENTER" spacing="10" 
                          styleClass="overlay" visible="false">
                        <ProgressIndicator/>
                        <Label text="Initializing camera..." styleClass="text-white"/>
                    </VBox>
                    
                    <VBox fx:id="cameraOffOverlay" alignment="CENTER" spacing="10" 
                          styleClass="overlay" visible="true">
                        <Label text="ðŸ“·" style="-fx-font-size: 48px;"/>
                        <Label text="Camera is off" styleClass="text-white" 
                               style="-fx-font-size: 18px; -fx-font-weight: bold;"/>
                        <Label text="Click 'Start Camera' to begin" styleClass="text-white"/>
                    </VBox>
                </StackPane>
                
                <HBox spacing="12" alignment="CENTER">
                    <Button fx:id="cameraButton" text="Start Camera" 
                            styleClass="btn, btn-primary" onAction="#handleCameraToggle"
                            prefWidth="150"/>
                </HBox>
            </VBox>

            <VBox spacing="20" prefWidth="350" minWidth="350" maxWidth="350">
                
                <VBox styleClass="card" spacing="12">
                    <Label text="Recognition Status" styleClass="card-title"/>
                    
                    <HBox spacing="12" alignment="CENTER_LEFT">
                        <StackPane styleClass="status-icon-container">
                            <Circle radius="20" styleClass="status-icon-bg"/>
                            <Label fx:id="recognitionIcon" text="ðŸ‘¤" styleClass="status-icon"/>
                        </StackPane>
                        
                        <VBox spacing="4" HBox.hgrow="ALWAYS">
                            <Label fx:id="recognitionStatus" text="Ready" 
                                   styleClass="text-large" style="-fx-font-weight: bold;"/>
                            <Label fx:id="recognitionDetails" text="Waiting for face detection" 
                                   styleClass="text-muted"/>
                        </VBox>
                        
                        <StackPane fx:id="statusIndicator" styleClass="status-dot, status-idle"/>
                    </HBox>
                </VBox>

                <HBox spacing="12">
                    <VBox styleClass="card, stat-card" HBox.hgrow="ALWAYS" spacing="8">
                        <Label text="Total Records" styleClass="stat-label"/>
                        <Label fx:id="recordCountLabel" text="0" styleClass="stat-value"/>
                    </VBox>
                    
                    <VBox styleClass="card, stat-card" HBox.hgrow="ALWAYS" spacing="8">
                        <Label text="Last Update" styleClass="stat-label"/>
                        <Label fx:id="lastUpdateLabel" text="Never" styleClass="stat-value-small"/>
                    </VBox>
                </HBox>

                <VBox styleClass="card" spacing="12" VBox.vgrow="ALWAYS">
                    <Label text="Recent Attendance" styleClass="card-title"/>
                    
                    <TableView fx:id="recentAttendanceTable" styleClass="modern-table" VBox.vgrow="ALWAYS">
                        <columns>
                            <TableColumn fx:id="dateColumn" text="Date" prefWidth="100"/>
                            <TableColumn fx:id="timeColumn" text="Time" prefWidth="80"/>
                            <TableColumn fx:id="statusColumn" text="Status" prefWidth="90"/>
                        </columns>
                        <placeholder>
                            <VBox alignment="CENTER" spacing="8" style="-fx-padding: 40px;">
                                <Label text="ðŸ“‹" style="-fx-font-size: 36px; -fx-opacity: 0.3;"/>
                                <Label text="No recent records" styleClass="text-muted"/>
                            </VBox>
                        </placeholder>
                    </TableView>
                    
                    <Button text="Refresh" styleClass="btn, btn-outlined" 
                            onAction="#handleRefresh" maxWidth="Infinity"/>
                </VBox>

            </VBox>
        </HBox>
    </center>

    <bottom>
        <HBox styleClass="footer-bar" alignment="CENTER" spacing="8">
            <padding>
                <Insets topRightBottomLeft="12"/>
            </padding>
            <Label text="IceFX Attendance System v2.0" styleClass="footer-text"/>
            <Label text="â€¢" styleClass="footer-text"/>
            <Label text="Facial Recognition Powered" styleClass="footer-text"/>
        </HBox>
    </bottom>

</BorderPane>
