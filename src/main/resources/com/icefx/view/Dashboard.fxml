<?xml version="1.0" encoding="UTF-8"?>

<?import javafx.geometry.Insets?>
<?import javafx.scene.control.*?>
<?import javafx.scene.image.ImageView?>
<?import javafx.scene.layout.*?>

<BorderPane xmlns="http://javafx.com/javafx/23" xmlns:fx="http://javafx.com/fxml/1"
            fx:controller="com.icefx.controller.DashboardController"
            styleClass="root-container"
            stylesheets="@../styles/enterprise-theme.css"
            prefHeight="800" prefWidth="1400">

    <top>
        <HBox styleClass="header-bar" alignment="CENTER_LEFT" spacing="20">
            <padding>
                <Insets topRightBottomLeft="16"/>
            </padding>
            
            <Label text="IceFX Attendance" styleClass="header-title"/>
            
            <Region HBox.hgrow="ALWAYS"/>
            
            <VBox alignment="CENTER_RIGHT" spacing="2">
                <Label fx:id="userNameLabel" text="Student Name" styleClass="header-user-name"/>
                <Label fx:id="userRoleLabel" text="Student" styleClass="header-user-role"/>
            </VBox>
            
            <Button text="Logout" styleClass="btn, btn-outlined, btn-error" onAction="#handleLogout">
                <graphic>
                    <Label text="ðŸšª" style="-fx-font-size: 16px;"/>
                </graphic>
            </Button>
        </HBox>
    </top>

    <center>
        <HBox spacing="24" styleClass="content-area">
            <padding>
                <Insets topRightBottomLeft="24"/>
            </padding>

            <VBox spacing="20" HBox.hgrow="ALWAYS">
                <Label text="Live Camera Feed" styleClass="section-title"/>
                
                <StackPane styleClass="camera-panel" VBox.vgrow="ALWAYS" prefHeight="480">
                    <ImageView fx:id="cameraView" fitWidth="640" fitHeight="480" preserveRatio="true"/>

                    <StackPane fx:id="loadingOverlay" alignment="CENTER" styleClass="overlay" visible="false">
                        <VBox alignment="CENTER" spacing="12">
                            <ProgressIndicator style="-fx-progress-color: white;"/>
                            <Label text="Initializing camera..." styleClass="text-white" style="-fx-font-size: 16px;"/>
                        </VBox>
                    </StackPane>

                    <VBox fx:id="cameraOffOverlay" alignment="CENTER" spacing="12"
                          styleClass="overlay" visible="true">
                        <Label text="ðŸ“·" style="-fx-font-size: 64px;"/>
                        <Label text="Camera is offline" styleClass="text-white"
                               style="-fx-font-size: 22px; -fx-font-weight: bold;"/>
                        <Label text="Click 'Start Camera' to begin face recognition" styleClass="text-white" style="-fx-font-size: 14px;"/>
                    </VBox>
                </StackPane>                <HBox spacing="16" alignment="CENTER">
                    <Button fx:id="startCameraButton" text="â–¶ Start Camera" 
                            styleClass="btn, btn-success" onAction="#handleStartCamera"
                            prefWidth="160" prefHeight="40" style="-fx-font-size: 14px;"/>
                    <Button fx:id="stopCameraButton" text="â¹ Stop Camera" 
                            styleClass="btn, btn-error" onAction="#handleStopCamera"
                            prefWidth="160" prefHeight="40" style="-fx-font-size: 14px;" disable="true"/>
                </HBox>
                
                <HBox spacing="12" alignment="CENTER_LEFT" styleClass="info-box" style="-fx-padding: 12px;">
                    <Label fx:id="statusLabel" text="System ready" styleClass="text-muted" HBox.hgrow="ALWAYS"/>
                    <Label fx:id="fpsLabel" text="FPS: 0" styleClass="text-muted" style="-fx-font-size: 12px;"/>
                    <Label fx:id="statusIndicator" text="â—" style="-fx-font-size: 18px; -fx-text-fill: #BDBDBD;"/>
                </HBox>
            </VBox>

            <VBox spacing="20" prefWidth="420" minWidth="420" maxWidth="420">
                
                <VBox styleClass="card" spacing="16">
                    <Label text="Recognition Status" styleClass="card-title"/>
                    
                    <HBox spacing="16" alignment="CENTER_LEFT">
                        <Label fx:id="recognitionIcon" text="ðŸ‘¤" style="-fx-font-size: 48px;"/>
                        
                        <VBox spacing="6" HBox.hgrow="ALWAYS">
                            <Label fx:id="recognitionLabel" text="Ready for detection" 
                                   styleClass="text-large" style="-fx-font-weight: bold;"/>
                            <Label fx:id="recognitionDetails" text="Waiting for face" 
                                   styleClass="text-muted"/>
                        </VBox>
                    </HBox>
                </VBox>

                <HBox spacing="16">
                    <VBox styleClass="card, stat-card" HBox.hgrow="ALWAYS" spacing="8">
                        <Label text="Today" styleClass="stat-label"/>
                        <Label fx:id="todayCountLabel" text="0" styleClass="stat-value"/>
                    </VBox>
                    
                    <VBox styleClass="card, stat-card" HBox.hgrow="ALWAYS" spacing="8">
                        <Label text="This Week" styleClass="stat-label"/>
                        <Label fx:id="weekCountLabel" text="0" styleClass="stat-value"/>
                    </VBox>
                </HBox>
                
                <HBox spacing="16">
                    <VBox styleClass="card, stat-card" HBox.hgrow="ALWAYS" spacing="8">
                        <Label text="Total Records" styleClass="stat-label"/>
                        <Label fx:id="recordCountLabel" text="0" styleClass="stat-value"/>
                    </VBox>
                    
                    <VBox styleClass="card, stat-card" HBox.hgrow="ALWAYS" spacing="8">
                        <Label text="Last Update" styleClass="stat-label"/>
                        <Label fx:id="lastUpdateLabel" text="Never" styleClass="stat-value-small"/>
                    </VBox>
                </HBox>

                <VBox styleClass="card" spacing="16" VBox.vgrow="ALWAYS">
                    <HBox alignment="CENTER_LEFT" spacing="12">
                        <Label text="Recent Attendance" styleClass="card-title" HBox.hgrow="ALWAYS"/>
                        <Button text="ðŸ”„" styleClass="btn, btn-outlined, btn-sm" 
                                onAction="#handleRefresh" tooltip="Refresh"/>
                    </HBox>
                    
                    <TableView fx:id="attendanceTable" styleClass="modern-table" VBox.vgrow="ALWAYS">
                        <columns>
                            <TableColumn fx:id="timeColumn" text="Time" prefWidth="80"/>
                            <TableColumn fx:id="nameColumn" text="Name" prefWidth="140"/>
                            <TableColumn fx:id="eventColumn" text="Event" prefWidth="100"/>
                            <TableColumn fx:id="confidenceColumn" text="Confidence" prefWidth="90"/>
                        </columns>
                        <placeholder>
                            <VBox alignment="CENTER" spacing="12" style="-fx-padding: 60px;">
                                <Label text="ðŸ“‹" style="-fx-font-size: 48px; -fx-opacity: 0.3;"/>
                                <Label text="No attendance records today" styleClass="text-muted" style="-fx-font-size: 16px;"/>
                                <Label text="Start camera to begin tracking" styleClass="text-muted"/>
                            </VBox>
                        </placeholder>
                    </TableView>
                </VBox>

            </VBox>
        </HBox>
    </center>

    <bottom>
        <HBox styleClass="footer-bar" alignment="CENTER" spacing="8">
            <padding>
                <Insets topRightBottomLeft="12"/>
            </padding>
            <Label text="IceFX Attendance System v2.0" styleClass="footer-text"/>
            <Label text="â€¢" styleClass="footer-text"/>
            <Label text="Facial Recognition Powered" styleClass="footer-text"/>
        </HBox>
    </bottom>

</BorderPane>
