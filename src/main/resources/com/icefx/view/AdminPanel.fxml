<?xml version="1.0" encoding="UTF-8"?>

<?import javafx.geometry.Insets?>
<?import javafx.scene.control.*?>
<?import javafx.scene.layout.*?>
<?import javafx.scene.text.Font?>

<BorderPane xmlns="http://javafx.com/javafx/21.0.1"
            xmlns:fx="http://javafx.com/fxml/1"
            fx:controller="com.icefx.controller.AdminController"
            prefHeight="800.0" prefWidth="1400.0"
            stylesheets="@../../application/application.css">
    
    <!-- Top: Header -->
    <top>
        <VBox style="-fx-background-color: #1976D2; -fx-padding: 15;">
            <HBox alignment="CENTER_LEFT" spacing="20">
                <Label text="IceFX Attendance System" textFill="WHITE">
                    <font>
                        <Font name="System Bold" size="24.0" />
                    </font>
                </Label>
                <Region HBox.hgrow="ALWAYS"/>
                <Label text="Admin Panel" textFill="#E3F2FD">
                    <font>
                        <Font size="18.0" />
                    </font>
                </Label>
            </HBox>
        </VBox>
    </top>
    
    <!-- Center: Main Content -->
    <center>
        <HBox spacing="15" style="-fx-padding: 15;">
            
            <!-- Left: User Management -->
            <VBox spacing="15" prefWidth="900" HBox.hgrow="ALWAYS">
                
                <!-- Statistics Cards -->
                <HBox spacing="15">
                    <VBox spacing="5" 
                         style="-fx-background-color: #4CAF50; -fx-padding: 15; -fx-background-radius: 5;"
                         HBox.hgrow="ALWAYS">
                        <Label text="Total Users" textFill="WHITE">
                            <font>
                                <Font size="12.0" />
                            </font>
                        </Label>
                        <Label fx:id="totalUsersLabel" text="0" textFill="WHITE">
                            <font>
                                <Font name="System Bold" size="28.0" />
                            </font>
                        </Label>
                    </VBox>
                    
                    <VBox spacing="5" 
                         style="-fx-background-color: #2196F3; -fx-padding: 15; -fx-background-radius: 5;"
                         HBox.hgrow="ALWAYS">
                        <Label text="Active" textFill="WHITE">
                            <font>
                                <Font size="12.0" />
                            </font>
                        </Label>
                        <Label fx:id="activeUsersLabel" text="0" textFill="WHITE">
                            <font>
                                <Font name="System Bold" size="28.0" />
                            </font>
                        </Label>
                    </VBox>
                    
                    <VBox spacing="5" 
                         style="-fx-background-color: #FF9800; -fx-padding: 15; -fx-background-radius: 5;"
                         HBox.hgrow="ALWAYS">
                        <Label text="Admins" textFill="WHITE">
                            <font>
                                <Font size="12.0" />
                            </font>
                        </Label>
                        <Label fx:id="adminCountLabel" text="0" textFill="WHITE">
                            <font>
                                <Font name="System Bold" size="28.0" />
                            </font>
                        </Label>
                    </VBox>
                </HBox>
                
                <!-- Search and Filter -->
                <HBox spacing="10" 
                     style="-fx-background-color: white; -fx-padding: 10; -fx-background-radius: 5; -fx-effect: dropshadow(three-pass-box, rgba(0,0,0,0.1), 10, 0, 0, 0);">
                    <TextField fx:id="searchField" 
                              promptText="ðŸ” Search by user code, name, or email..." 
                              HBox.hgrow="ALWAYS"
                              style="-fx-font-size: 14px;"/>
                    <ComboBox fx:id="roleFilterComboBox" 
                             prefWidth="150"
                             style="-fx-font-size: 14px;"/>
                    <Button text="ðŸ”„ Refresh" 
                           onAction="#handleRefresh"
                           style="-fx-background-color: #2196F3; -fx-text-fill: white; -fx-font-weight: bold;">
                        <font>
                            <Font size="14.0" />
                        </font>
                    </Button>
                </HBox>
                
                <!-- User Table -->
                <VBox spacing="10" 
                     style="-fx-background-color: white; -fx-padding: 15; -fx-background-radius: 5; -fx-effect: dropshadow(three-pass-box, rgba(0,0,0,0.1), 10, 0, 0, 0);"
                     VBox.vgrow="ALWAYS">
                    <Label text="User Management" style="-fx-font-size: 18px; -fx-font-weight: bold;"/>
                    <Separator/>
                    
                    <TableView fx:id="userTable" VBox.vgrow="ALWAYS">
                        <columns>
                            <TableColumn fx:id="idColumn" 
                                        text="ID" 
                                        prefWidth="50"
                                        style="-fx-alignment: CENTER;"/>
                            <TableColumn fx:id="userCodeColumn" 
                                        text="User Code" 
                                        prefWidth="120"
                                        style="-fx-font-weight: bold;"/>
                            <TableColumn fx:id="nameColumn" 
                                        text="Name" 
                                        prefWidth="200"/>
                            <TableColumn fx:id="emailColumn" 
                                        text="Email" 
                                        prefWidth="220"/>
                            <TableColumn fx:id="roleColumn" 
                                        text="Role" 
                                        prefWidth="100"
                                        style="-fx-alignment: CENTER;"/>
                            <TableColumn fx:id="statusColumn" 
                                        text="Status" 
                                        prefWidth="100"
                                        style="-fx-alignment: CENTER;"/>
                        </columns>
                        <placeholder>
                            <Label text="No users found" 
                                  style="-fx-text-fill: #757575;"/>
                        </placeholder>
                    </TableView>
                </VBox>
                
            </VBox>
            
            <!-- Right: User Form and Face Training -->
            <VBox spacing="15" prefWidth="450">
                
                <!-- User Form -->
                <VBox spacing="10" 
                     style="-fx-background-color: white; -fx-padding: 15; -fx-background-radius: 5; -fx-effect: dropshadow(three-pass-box, rgba(0,0,0,0.1), 10, 0, 0, 0);">
                    <Label text="User Details" style="-fx-font-size: 18px; -fx-font-weight: bold;"/>
                    <Separator/>
                    
                    <!-- User Code -->
                    <VBox spacing="5">
                        <Label text="User Code *" style="-fx-font-size: 13px; -fx-font-weight: bold;"/>
                        <TextField fx:id="userCodeField" 
                                  promptText="Enter user code (e.g., 2021-001)"
                                  style="-fx-font-size: 14px;"/>
                    </VBox>
                    
                    <!-- Name -->
                    <VBox spacing="5">
                        <Label text="Full Name *" style="-fx-font-size: 13px; -fx-font-weight: bold;"/>
                        <TextField fx:id="nameField" 
                                  promptText="Enter full name"
                                  style="-fx-font-size: 14px;"/>
                    </VBox>
                    
                    <!-- Email -->
                    <VBox spacing="5">
                        <Label text="Email" style="-fx-font-size: 13px; -fx-font-weight: bold;"/>
                        <TextField fx:id="emailField" 
                                  promptText="Enter email address"
                                  style="-fx-font-size: 14px;"/>
                    </VBox>
                    
                    <!-- Password -->
                    <VBox spacing="5">
                        <Label text="Password *" style="-fx-font-size: 13px; -fx-font-weight: bold;"/>
                        <PasswordField fx:id="passwordField" 
                                      promptText="Enter password (or leave blank to keep current)"
                                      style="-fx-font-size: 14px;"/>
                    </VBox>
                    
                    <!-- Role -->
                    <VBox spacing="5">
                        <Label text="Role *" style="-fx-font-size: 13px; -fx-font-weight: bold;"/>
                        <ComboBox fx:id="roleComboBox" 
                                 maxWidth="Infinity"
                                 style="-fx-font-size: 14px;"/>
                    </VBox>
                    
                    <!-- Status -->
                    <VBox spacing="5">
                        <Label text="Status" style="-fx-font-size: 13px; -fx-font-weight: bold;"/>
                        <ComboBox fx:id="statusComboBox" 
                                 maxWidth="Infinity"
                                 style="-fx-font-size: 14px;"/>
                    </VBox>
                    
                    <Separator/>
                    
                    <!-- Action Buttons -->
                    <GridPane hgap="10" vgap="10">
                        <columnConstraints>
                            <ColumnConstraints percentWidth="50"/>
                            <ColumnConstraints percentWidth="50"/>
                        </columnConstraints>
                        
                        <Button fx:id="addButton" 
                               text="âž• Add User" 
                               onAction="#handleAdd"
                               maxWidth="Infinity"
                               style="-fx-background-color: #4CAF50; -fx-text-fill: white; -fx-font-weight: bold;"
                               GridPane.columnIndex="0" GridPane.rowIndex="0">
                            <font>
                                <Font size="13.0" />
                            </font>
                        </Button>
                        
                        <Button fx:id="updateButton" 
                               text="âœï¸ Update" 
                               onAction="#handleUpdate"
                               maxWidth="Infinity"
                               style="-fx-background-color: #2196F3; -fx-text-fill: white; -fx-font-weight: bold;"
                               GridPane.columnIndex="1" GridPane.rowIndex="0">
                            <font>
                                <Font size="13.0" />
                            </font>
                        </Button>
                        
                        <Button fx:id="deleteButton" 
                               text="ðŸ—‘ï¸ Delete" 
                               onAction="#handleDelete"
                               maxWidth="Infinity"
                               style="-fx-background-color: #F44336; -fx-text-fill: white; -fx-font-weight: bold;"
                               GridPane.columnIndex="0" GridPane.rowIndex="1">
                            <font>
                                <Font size="13.0" />
                            </font>
                        </Button>
                        
                        <Button fx:id="clearButton" 
                               text="ðŸ”„ Clear" 
                               onAction="#handleClear"
                               maxWidth="Infinity"
                               style="-fx-background-color: #757575; -fx-text-fill: white; -fx-font-weight: bold;"
                               GridPane.columnIndex="1" GridPane.rowIndex="1">
                            <font>
                                <Font size="13.0" />
                            </font>
                        </Button>
                    </GridPane>
                    
                    <Label text="* Required fields" 
                          style="-fx-font-size: 11px; -fx-text-fill: #757575; -fx-font-style: italic;"/>
                </VBox>
                
                <!-- Face Training -->
                <VBox spacing="10" 
                     style="-fx-background-color: white; -fx-padding: 15; -fx-background-radius: 5; -fx-effect: dropshadow(three-pass-box, rgba(0,0,0,0.1), 10, 0, 0, 0);">
                    <Label text="Face Recognition Model" style="-fx-font-size: 18px; -fx-font-weight: bold;"/>
                    <Separator/>
                    
                    <!-- Model Status -->
                    <HBox alignment="CENTER_LEFT" spacing="10">
                        <Label text="Status:" style="-fx-font-size: 13px;"/>
                        <Label fx:id="modelStatusLabel" 
                              text="âœ— No Model" 
                              style="-fx-font-size: 13px; -fx-text-fill: #F44336; -fx-font-weight: bold;"/>
                    </HBox>
                    
                    <!-- Training Status -->
                    <VBox spacing="5">
                        <Label fx:id="trainingStatusLabel" 
                              text="Ready to train" 
                              style="-fx-font-size: 12px; -fx-text-fill: #757575;"/>
                        <ProgressBar fx:id="trainingProgressBar" 
                                    maxWidth="Infinity" 
                                    visible="false"/>
                    </VBox>
                    
                    <Separator/>
                    
                    <!-- Training Buttons -->
                    <VBox spacing="10">
                        <Button fx:id="trainButton" 
                               text="ðŸŽ“ Train Model" 
                               onAction="#handleTrainModel"
                               maxWidth="Infinity"
                               style="-fx-background-color: #4CAF50; -fx-text-fill: white; -fx-font-weight: bold;">
                            <font>
                                <Font size="13.0" />
                            </font>
                        </Button>
                        
                        <HBox spacing="10">
                            <Button fx:id="loadModelButton" 
                                   text="ðŸ“‚ Load" 
                                   onAction="#handleLoadModel"
                                   HBox.hgrow="ALWAYS"
                                   maxWidth="Infinity"
                                   style="-fx-background-color: #2196F3; -fx-text-fill: white; -fx-font-weight: bold;">
                                <font>
                                    <Font size="13.0" />
                                </font>
                            </Button>
                            
                            <Button fx:id="saveModelButton" 
                                   text="ðŸ’¾ Save" 
                                   onAction="#handleSaveModel"
                                   HBox.hgrow="ALWAYS"
                                   maxWidth="Infinity"
                                   style="-fx-background-color: #FF9800; -fx-text-fill: white; -fx-font-weight: bold;">
                                <font>
                                    <Font size="13.0" />
                                </font>
                            </Button>
                        </HBox>
                    </VBox>
                    
                    <!-- Training Instructions -->
                    <VBox spacing="5" 
                         style="-fx-background-color: #E3F2FD; -fx-padding: 10; -fx-background-radius: 3;">
                        <Label text="Training Instructions:" 
                              style="-fx-font-size: 12px; -fx-font-weight: bold;"/>
                        <Label text="1. Organize face images in folders" 
                              wrapText="true" 
                              style="-fx-font-size: 11px;"/>
                        <Label text="2. Folder name = User ID from database" 
                              wrapText="true" 
                              style="-fx-font-size: 11px;"/>
                        <Label text="3. Click 'Train Model' and select directory" 
                              wrapText="true" 
                              style="-fx-font-size: 11px;"/>
                        <Label text="4. Wait for training to complete" 
                              wrapText="true" 
                              style="-fx-font-size: 11px;"/>
                        <Label text="5. Save model for future use" 
                              wrapText="true" 
                              style="-fx-font-size: 11px;"/>
                    </VBox>
                </VBox>
                
            </VBox>
            
        </HBox>
    </center>
    
    <!-- Bottom: Footer -->
    <bottom>
        <HBox alignment="CENTER" 
             spacing="20" 
             style="-fx-background-color: #F5F5F5; -fx-padding: 10;">
            <Label text="Admin Panel" style="-fx-font-size: 11px; -fx-text-fill: #757575;"/>
            <Separator orientation="VERTICAL"/>
            <Label text="User Management &amp; Face Training" style="-fx-font-size: 11px; -fx-text-fill: #757575;"/>
            <Region HBox.hgrow="ALWAYS"/>
            <Label text="Version 2.0" style="-fx-font-size: 11px; -fx-text-fill: #757575;"/>
        </HBox>
    </bottom>
    
</BorderPane>
