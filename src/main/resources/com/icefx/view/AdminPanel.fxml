<?xml version="1.0" encoding="UTF-8"?>

<?import javafx.geometry.Insets?>
<?import javafx.scene.control.*?>
<?import javafx.scene.layout.*?>

<BorderPane xmlns="http://javafx.com/javafx/23.0.1"
            xmlns:fx="http://javafx.com/fxml/1"
            fx:controller="com.icefx.controller.AdminController"
            prefHeight="900.0" prefWidth="1600.0"
            styleClass="root">
    
    <!-- Top: Header -->
    <top>
        <VBox styleClass="dashboard-header">
            <HBox alignment="CENTER_LEFT" styleClass="gap-4">
                <Label text="IceFX Attendance System" 
                      style="-fx-text-fill: white; -fx-font-size: 26px; -fx-font-weight: 700;"/>
                <Region HBox.hgrow="ALWAYS"/>
                <Label text="Admin Panel" 
                      style="-fx-text-fill: #e3f2fd; -fx-font-size: 18px; -fx-font-weight: 600;"/>
            </HBox>
        </VBox>
    </top>
    
    <!-- Center: Main Content -->
    <center>
        <HBox styleClass="gap-4 m-4">
            
            <!-- Left: User Management -->
            <VBox styleClass="gap-4" prefWidth="950" HBox.hgrow="ALWAYS">
                
                <!-- Statistics Cards Row -->
                <HBox styleClass="gap-3">
                    <!-- Total Users -->
                    <VBox styleClass="stat-card-success gap-1" HBox.hgrow="ALWAYS">
                        <Label text="Total Users" 
                              style="-fx-text-fill: white; -fx-font-size: 13px; -fx-font-weight: 600;"/>
                        <Label fx:id="totalUsersLabel" text="0" 
                              style="-fx-text-fill: white; -fx-font-size: 38px; -fx-font-weight: 700;"/>
                        <Label text="Registered" 
                              style="-fx-text-fill: rgba(255,255,255,0.85); -fx-font-size: 12px;"/>
                    </VBox>
                    
                    <!-- Active Users -->
                    <VBox styleClass="stat-card-info gap-1" HBox.hgrow="ALWAYS">
                        <Label text="Active Users" 
                              style="-fx-text-fill: white; -fx-font-size: 13px; -fx-font-weight: 600;"/>
                        <Label fx:id="activeUsersLabel" text="0" 
                              style="-fx-text-fill: white; -fx-font-size: 38px; -fx-font-weight: 700;"/>
                        <Label text="Active Status" 
                              style="-fx-text-fill: rgba(255,255,255,0.85); -fx-font-size: 12px;"/>
                    </VBox>
                    
                    <!-- Admin Count -->
                    <VBox styleClass="stat-card-warning gap-1" HBox.hgrow="ALWAYS">
                        <Label text="Administrators" 
                              style="-fx-text-fill: white; -fx-font-size: 13px; -fx-font-weight: 600;"/>
                        <Label fx:id="adminCountLabel" text="0" 
                              style="-fx-text-fill: white; -fx-font-size: 38px; -fx-font-weight: 700;"/>
                        <Label text="Admin Role" 
                              style="-fx-text-fill: rgba(255,255,255,0.85); -fx-font-size: 12px;"/>
                    </VBox>
                </HBox>
                
                <!-- Search and Filter Card -->
                <HBox styleClass="card gap-3" alignment="CENTER_LEFT">
                    <TextField fx:id="searchField" 
                              promptText="ðŸ” Search by user code, name, or email..." 
                              HBox.hgrow="ALWAYS"
                              style="-fx-font-size: 14px; -fx-min-height: 40px;"/>
                    <ComboBox fx:id="roleFilterComboBox" 
                             prefWidth="150"
                             style="-fx-font-size: 14px; -fx-min-height: 40px;"/>
                    <Button text="ðŸ”„  Refresh" 
                           onAction="#handleRefresh"
                           styleClass="button-info"
                           style="-fx-font-size: 14px; -fx-min-height: 40px;"/>
                </HBox>
                
                <!-- User Table Card -->
                <VBox styleClass="card gap-3" VBox.vgrow="ALWAYS">
                    <Label text="User Management" 
                          style="-fx-font-size: 20px; -fx-font-weight: 700; -fx-text-fill: #212121;"/>
                    <Separator/>
                    
                    <TableView fx:id="userTable" VBox.vgrow="ALWAYS">
                        <columns>
                            <TableColumn fx:id="idColumn" 
                                        text="ID" 
                                        prefWidth="60"
                                        sortable="true"/>
                            <TableColumn fx:id="userCodeColumn" 
                                        text="User Code" 
                                        prefWidth="130"
                                        sortable="true"/>
                            <TableColumn fx:id="nameColumn" 
                                        text="Full Name" 
                                        prefWidth="240"
                                        sortable="true"/>
                            <TableColumn fx:id="emailColumn" 
                                        text="Email Address" 
                                        prefWidth="260"
                                        sortable="true"/>
                            <TableColumn fx:id="roleColumn" 
                                        text="Role" 
                                        prefWidth="100"
                                        sortable="true"/>
                            <TableColumn fx:id="statusColumn" 
                                        text="Status" 
                                        prefWidth="100"
                                        sortable="true"/>
                        </columns>
                        <placeholder>
                            <VBox alignment="CENTER" styleClass="gap-2 m-5">
                                <Label text="ðŸ‘¥" style="-fx-font-size: 48px;"/>
                                <Label text="No users found" 
                                      styleClass="label-tertiary"
                                      style="-fx-font-size: 15px;"/>
                                <Label text="Add a new user to get started" 
                                      styleClass="label-tertiary"
                                      style="-fx-font-size: 13px;"/>
                            </VBox>
                        </placeholder>
                    </TableView>
                </VBox>
                
            </VBox>
            
            <!-- Right: User Form and Face Training -->
            <VBox styleClass="gap-4" prefWidth="600">
                
                <!-- User Details Form Card -->
                <VBox styleClass="card gap-3">
                    <Label text="User Details" 
                          style="-fx-font-size: 20px; -fx-font-weight: 700; -fx-text-fill: #212121;"/>
                    <Separator/>
                    
                    <!-- User Code -->
                    <VBox styleClass="gap-2">
                        <Label text="User Code *" styleClass="field-label"/>
                        <TextField fx:id="userCodeField" 
                                  promptText="e.g., 2021-001 or ADMIN001"
                                  style="-fx-font-size: 14px;"/>
                    </VBox>
                    
                    <!-- Full Name -->
                    <VBox styleClass="gap-2">
                        <Label text="Full Name *" styleClass="field-label"/>
                        <TextField fx:id="nameField" 
                                  promptText="Enter full name"
                                  style="-fx-font-size: 14px;"/>
                    </VBox>
                    
                    <!-- Email -->
                    <VBox styleClass="gap-2">
                        <Label text="Email Address" styleClass="field-label"/>
                        <TextField fx:id="emailField" 
                                  promptText="email@example.com"
                                  style="-fx-font-size: 14px;"/>
                    </VBox>
                    
                    <!-- Password -->
                    <VBox styleClass="gap-2">
                        <Label text="Password *" styleClass="field-label"/>
                        <PasswordField fx:id="passwordField" 
                                      promptText="Leave blank to keep current password"
                                      style="-fx-font-size: 14px;"/>
                    </VBox>
                    
                    <!-- Role -->
                    <VBox styleClass="gap-2">
                        <Label text="Role *" styleClass="field-label"/>
                        <ComboBox fx:id="roleComboBox" 
                                 maxWidth="Infinity"
                                 style="-fx-font-size: 14px;"/>
                    </VBox>
                    
                    <!-- Status -->
                    <VBox styleClass="gap-2">
                        <Label text="Status" styleClass="field-label"/>
                        <ComboBox fx:id="statusComboBox" 
                                 maxWidth="Infinity"
                                 style="-fx-font-size: 14px;"/>
                    </VBox>
                    
                    <Separator/>
                    
                    <!-- Action Buttons Grid -->
                    <GridPane hgap="10" vgap="10">
                        <columnConstraints>
                            <ColumnConstraints percentWidth="50"/>
                            <ColumnConstraints percentWidth="50"/>
                        </columnConstraints>
                        
                        <Button fx:id="addButton" 
                               text="âž•  Add User" 
                               onAction="#handleAdd"
                               maxWidth="Infinity"
                               styleClass="button-success"
                               style="-fx-font-size: 14px; -fx-min-height: 44px;"
                               GridPane.columnIndex="0" GridPane.rowIndex="0"/>
                        
                        <Button fx:id="updateButton" 
                               text="âœï¸  Update" 
                               onAction="#handleUpdate"
                               maxWidth="Infinity"
                               styleClass="button-info"
                               style="-fx-font-size: 14px; -fx-min-height: 44px;"
                               GridPane.columnIndex="1" GridPane.rowIndex="0"/>
                        
                        <Button fx:id="deleteButton" 
                               text="ðŸ—‘ï¸  Delete" 
                               onAction="#handleDelete"
                               maxWidth="Infinity"
                               styleClass="button-danger"
                               style="-fx-font-size: 14px; -fx-min-height: 44px;"
                               GridPane.columnIndex="0" GridPane.rowIndex="1"/>
                        
                        <Button fx:id="clearButton" 
                               text="ðŸ”„  Clear Form" 
                               onAction="#handleClear"
                               maxWidth="Infinity"
                               styleClass="button"
                               style="-fx-font-size: 14px; -fx-min-height: 44px; -fx-background-color: #757575; -fx-text-fill: white; -fx-border-color: transparent;"
                               GridPane.columnIndex="1" GridPane.rowIndex="1"/>
                    </GridPane>
                    
                    <Label text="* Required fields" 
                          styleClass="label-tertiary"
                          style="-fx-font-size: 12px; -fx-font-style: italic;"/>
                </VBox>
                
                <!-- Face Recognition Model Card -->
                <VBox styleClass="card gap-3">
                    <Label text="Face Recognition Model" 
                          style="-fx-font-size: 20px; -fx-font-weight: 700; -fx-text-fill: #212121;"/>
                    <Separator/>
                    
                    <!-- Model Status -->
                    <HBox alignment="CENTER_LEFT" styleClass="gap-3">
                        <Label text="Model Status:" 
                              style="-fx-font-size: 14px; -fx-font-weight: 600;"/>
                        <Label fx:id="modelStatusLabel" 
                              text="âœ— No Model Loaded" 
                              style="-fx-font-size: 14px; -fx-text-fill: #f44336; -fx-font-weight: 600;"/>
                    </HBox>
                    
                    <!-- Training Progress -->
                    <VBox styleClass="gap-2">
                        <Label fx:id="trainingStatusLabel" 
                              text="Ready to train model" 
                              styleClass="label-tertiary"
                              style="-fx-font-size: 13px;"/>
                        <ProgressBar fx:id="trainingProgressBar" 
                                    maxWidth="Infinity" 
                                    visible="false"
                                    prefHeight="8"/>
                    </VBox>
                    
                    <Separator/>
                    
                    <!-- Training Action Buttons -->
                    <VBox styleClass="gap-3">
                        <Button fx:id="trainButton" 
                               text="ðŸŽ“  Train Model" 
                               onAction="#handleTrainModel"
                               maxWidth="Infinity"
                               styleClass="button-success"
                               style="-fx-font-size: 15px; -fx-min-height: 48px;"/>
                        
                        <HBox styleClass="gap-3">
                            <Button fx:id="loadModelButton" 
                                   text="ðŸ“‚  Load Model" 
                                   onAction="#handleLoadModel"
                                   HBox.hgrow="ALWAYS"
                                   maxWidth="Infinity"
                                   styleClass="button-info"
                                   style="-fx-font-size: 14px; -fx-min-height: 44px;"/>
                            
                            <Button fx:id="saveModelButton" 
                                   text="ðŸ’¾  Save Model" 
                                   onAction="#handleSaveModel"
                                   HBox.hgrow="ALWAYS"
                                   maxWidth="Infinity"
                                   styleClass="button-warning"
                                   style="-fx-font-size: 14px; -fx-min-height: 44px;"/>
                        </HBox>
                    </VBox>
                    
                    <!-- Training Instructions -->
                    <VBox styleClass="info-message gap-2">
                        <Label text="ðŸ“– Training Instructions" 
                              style="-fx-font-size: 13px; -fx-font-weight: 700; -fx-text-fill: #1565c0;"/>
                        <Label text="1. Organize face images in folders by User ID" 
                              wrapText="true" 
                              style="-fx-font-size: 12px; -fx-text-fill: #1565c0;"/>
                        <Label text="2. Click 'Train Model' and select the directory" 
                              wrapText="true" 
                              style="-fx-font-size: 12px; -fx-text-fill: #1565c0;"/>
                        <Label text="3. Wait for training to complete" 
                              wrapText="true" 
                              style="-fx-font-size: 12px; -fx-text-fill: #1565c0;"/>
                        <Label text="4. Save the trained model for future use" 
                              wrapText="true" 
                              style="-fx-font-size: 12px; -fx-text-fill: #1565c0;"/>
                    </VBox>
                </VBox>
                
            </VBox>
            
        </HBox>
    </center>
    
    <!-- Bottom: Footer -->
    <bottom>
        <HBox styleClass="panel-footer gap-4" alignment="CENTER">
            <Label text="Admin Panel" styleClass="version-label"/>
            <Separator orientation="VERTICAL"/>
            <Label text="User Management &amp; Face Training" styleClass="version-label"/>
            <Region HBox.hgrow="ALWAYS"/>
            <Label text="Version 3.0" styleClass="version-label"/>
        </HBox>
    </bottom>
    
</BorderPane>
