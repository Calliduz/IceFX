<?xml version="1.0" encoding="UTF-8"?>

<?import javafx.geometry.Insets?>
<?import javafx.scene.control.*?>
<?import javafx.scene.image.ImageView?>
<?import javafx.scene.layout.*?>
<?import javafx.scene.text.Text?>

<VBox xmlns="http://javafx.com/javafx" xmlns:fx="http://javafx.com/fxml"
      fx:controller="com.icefx.controller.FaceRegistrationController"
      spacing="16" style="-fx-background-color: #1E1E1E; -fx-padding: 20;">
    
    <!-- Header -->
    <HBox alignment="CENTER_LEFT" spacing="16">
        <Label text="ðŸ‘¤ Face Registration System" style="-fx-font-size: 24px; -fx-font-weight: bold; -fx-text-fill: white;"/>
        <Region HBox.hgrow="ALWAYS"/>
        <Button fx:id="closeButton" text="âœ• Close" onAction="#handleClose"
                style="-fx-background-color: #F44336; -fx-text-fill: white; -fx-font-size: 14px; -fx-padding: 8 16;"/>
    </HBox>
    
    <Separator style="-fx-background-color: #424242;"/>
    
    <!-- User Display (No Selection) -->
    <VBox spacing="8" style="-fx-background-color: #2C2C2C; -fx-padding: 16; -fx-background-radius: 8;">
        <Label text="1ï¸âƒ£ Registering Face For" style="-fx-font-size: 16px; -fx-font-weight: bold; -fx-text-fill: white;"/>
        <Label fx:id="selectedUserLabel" text="No user selected" 
               style="-fx-font-size: 18px; -fx-font-weight: bold; -fx-text-fill: #2196F3; -fx-padding: 8;"/>
        <Label text="Selected from Admin Panel user list" style="-fx-text-fill: #BDBDBD; -fx-font-size: 12px;"/>
    </VBox>
    
    <!-- Main Content -->
    <HBox spacing="16" VBox.vgrow="ALWAYS">
        
        <!-- Left Panel: Camera View -->
        <VBox spacing="12" prefWidth="640" style="-fx-background-color: #2C2C2C; -fx-padding: 16; -fx-background-radius: 8;">
            <Label text="2ï¸âƒ£ Capture Face Photos" style="-fx-font-size: 16px; -fx-font-weight: bold; -fx-text-fill: white;"/>
            
            <!-- Camera View -->
            <StackPane fx:id="cameraPane" prefHeight="480" style="-fx-background-color: black; -fx-background-radius: 8;">
                <ImageView fx:id="cameraView" fitWidth="640" fitHeight="480" preserveRatio="true"/>
                
                <!-- Overlay for no camera -->
                <VBox alignment="CENTER" spacing="12" style="-fx-background-color: rgba(0,0,0,0.7);">
                    <Label text="ðŸ“·" style="-fx-font-size: 48px;"/>
                    <Label text="Camera Not Active" style="-fx-text-fill: white; -fx-font-size: 18px;"/>
                    <Label text="Start camera to begin capturing" style="-fx-text-fill: #BDBDBD;"/>
                </VBox>
            </StackPane>
            
            <!-- Quality Feedback -->
            <HBox spacing="8" alignment="CENTER_LEFT" style="-fx-background-color: #1E1E1E; -fx-padding: 12; -fx-background-radius: 6;">
                <Label fx:id="qualityIcon" text="ðŸ“·" style="-fx-font-size: 24px;"/>
                <VBox spacing="4" HBox.hgrow="ALWAYS">
                    <Label text="Face Quality Check" style="-fx-text-fill: #BDBDBD; -fx-font-size: 11px;"/>
                    <Label fx:id="qualityLabel" text="Start camera to check face quality" 
                           style="-fx-text-fill: white; -fx-font-size: 14px; -fx-font-weight: bold;"/>
                </VBox>
            </HBox>
            
            <!-- Angle Guidance -->
            <HBox spacing="8" alignment="CENTER_LEFT" style="-fx-background-color: #3949AB; -fx-padding: 12; -fx-background-radius: 6;">
                <Label fx:id="angleGuideLabel" text="ðŸ“¸ Looking straight at camera (1/10)" 
                       style="-fx-text-fill: white; -fx-font-size: 14px; -fx-font-weight: bold;"/>
            </HBox>
            
            <!-- Camera Controls -->
            <HBox spacing="12" alignment="CENTER">
                <Button fx:id="startCameraButton" text="â–¶ Start Camera" onAction="#handleStartCamera"
                        style="-fx-background-color: #4CAF50; -fx-text-fill: white; -fx-font-size: 14px; -fx-padding: 10 20; -fx-background-radius: 6;"/>
                <Button fx:id="stopCameraButton" text="â¹ Stop Camera" onAction="#handleStopCamera"
                        style="-fx-background-color: #F44336; -fx-text-fill: white; -fx-font-size: 14px; -fx-padding: 10 20; -fx-background-radius: 6;"/>
                <Button fx:id="captureButton" text="ðŸ“¸ Capture Photo" onAction="#handleCapture"
                        style="-fx-background-color: #2196F3; -fx-text-fill: white; -fx-font-size: 14px; -fx-padding: 10 20; -fx-background-radius: 6;"/>
            </HBox>
            
            <!-- Auto-Capture Toggle -->
            <HBox spacing="12" alignment="CENTER" style="-fx-background-color: #1E1E1E; -fx-padding: 12; -fx-background-radius: 6;">
                <CheckBox fx:id="autoCaptureCheckbox" text="ðŸ¤– Auto-Capture Mode" 
                          onAction="#handleToggleAutoCapture"
                          style="-fx-text-fill: white; -fx-font-size: 13px; -fx-font-weight: bold;"/>
                <Region HBox.hgrow="ALWAYS"/>
                <Label text="Automatically captures when pose matches" style="-fx-text-fill: #BDBDBD; -fx-font-size: 11px;"/>
            </HBox>
        </VBox>
        
        <!-- Right Panel: Captured Photos & Training -->
        <VBox spacing="12" prefWidth="400" style="-fx-background-color: #2C2C2C; -fx-padding: 16; -fx-background-radius: 8;" VBox.vgrow="ALWAYS">
            <Label text="3ï¸âƒ£ Captured Photos" style="-fx-font-size: 16px; -fx-font-weight: bold; -fx-text-fill: white;"/>
            
            <!-- Capture Count -->
            <Label fx:id="captureCountLabel" text="âš ï¸ 0/10 photos (Need 5 more)" 
                   style="-fx-text-fill: #FFC107; -fx-font-size: 13px; -fx-font-weight: bold;"/>
            
            <!-- Photos Grid (Scrollable) -->
            <ScrollPane fitToWidth="true" VBox.vgrow="ALWAYS" 
                        style="-fx-background: transparent; -fx-background-color: transparent;">
                <FlowPane fx:id="photosGrid" hgap="12" vgap="12" 
                          style="-fx-background-color: #1E1E1E; -fx-padding: 12; -fx-background-radius: 6;"/>
            </ScrollPane>
            
            <!-- Clear Photos Button -->
            <Button text="ðŸ—‘ï¸ Clear All Photos" onAction="#handleClearPhotos"
                    style="-fx-background-color: #757575; -fx-text-fill: white; -fx-font-size: 12px; -fx-padding: 8 16;"/>
            
            <Separator style="-fx-background-color: #424242;"/>
            
            <!-- Training Section -->
            <Label text="4ï¸âƒ£ Train Model" style="-fx-font-size: 16px; -fx-font-weight: bold; -fx-text-fill: white;"/>
            
            <VBox spacing="8" style="-fx-background-color: #1E1E1E; -fx-padding: 12; -fx-background-radius: 6;">
                <Label text="â„¹ï¸ Training Information" style="-fx-text-fill: #64B5F6; -fx-font-weight: bold;"/>
                <Label text="â€¢ Minimum: 5 photos required" style="-fx-text-fill: #BDBDBD; -fx-font-size: 11px;"/>
                <Label text="â€¢ Recommended: 10 photos for best accuracy" style="-fx-text-fill: #BDBDBD; -fx-font-size: 11px;"/>
                <Label text="â€¢ Include different angles and expressions" style="-fx-text-fill: #BDBDBD; -fx-font-size: 11px;"/>
                <Label text="â€¢ Model will be trained with ALL users" style="-fx-text-fill: #BDBDBD; -fx-font-size: 11px;"/>
            </VBox>
            
            <!-- Training Progress (Hidden by default) -->
            <VBox fx:id="trainingBox" spacing="8" visible="false" 
                  style="-fx-background-color: #FFF3E0; -fx-padding: 12; -fx-background-radius: 6;">
                <Label text="Training in progress..." style="-fx-font-weight: bold;"/>
                <ProgressBar fx:id="trainingProgress" prefWidth="Infinity"/>
                <Label fx:id="trainingStatusLabel" text="Please wait..." style="-fx-font-size: 12px;"/>
            </VBox>
            
            <!-- Train Button -->
            <Button fx:id="trainButton" text="ðŸŽ¯ Train Recognition Model" onAction="#handleTrain"
                    style="-fx-background-color: #FF9800; -fx-text-fill: white; -fx-font-size: 14px; -fx-font-weight: bold; -fx-padding: 12 20; -fx-background-radius: 6;"/>
        </VBox>
    </HBox>
    
    <!-- Footer Help -->
    <VBox spacing="6" style="-fx-background-color: #263238; -fx-padding: 12; -fx-background-radius: 6;">
        <Label text="ðŸ’¡ Tips for Best Results:" style="-fx-text-fill: #4FC3F7; -fx-font-weight: bold;"/>
        <Label text="â€¢ Ensure good lighting (not too bright, not too dark)" style="-fx-text-fill: #B0BEC5; -fx-font-size: 11px;"/>
        <Label text="â€¢ Keep your face centered in the frame" style="-fx-text-fill: #B0BEC5; -fx-font-size: 11px;"/>
        <Label text="â€¢ Capture photos from different angles as guided" style="-fx-text-fill: #B0BEC5; -fx-font-size: 11px;"/>
        <Label text="â€¢ Remove glasses/hats if possible, or include both with and without" style="-fx-text-fill: #B0BEC5; -fx-font-size: 11px;"/>
    </VBox>
    
</VBox>
